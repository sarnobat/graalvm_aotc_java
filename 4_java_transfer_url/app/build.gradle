/*
 * This file was generated by the Gradle 'init' task.
 *
 * This generated file contains a sample Java application project to get you started.
 * For more details take a look at the 'Building Java & JVM projects' chapter in the Gradle
 * User Manual available at https://docs.gradle.org/7.5.1/userguide/building_java_projects.html
 */

plugins {
    // Apply the application plugin to add support for building a CLI application in Java.
    id 'application'
    id 'org.graalvm.buildtools.native' version '0.9.13'
}

repositories {
    mavenCentral()
}

dependencies {

    // This dependency is used by the application.
// 	implementation group: 'org.glassfish.jersey.containers', name: 'jersey-container-jdk-http', version: '3.0.8'
// 	implementation group: 'org.glassfish.jersey.core', name: 'jersey-server', version: '3.0.8'
// 	implementation group: 'javax.ws.rs', name: 'javax.ws.rs-api', version: '2.0.1'
// https://mvnrepository.com/artifact/org.glassfish.jersey.core/jersey-server


// implementation 'jakarta.activation:jakarta.activation-api:2.1.0'
// implementation 'jakarta.ws.rs:jakarta.ws.rs-api:2.0.0'
// https://mvnrepository.com/artifact/javax.ws.rs/javax.ws.rs-api
implementation 'javax.ws.rs:javax.ws.rs-api:2.1'

// implementation 'org.glassfish.jersey.core:jersey-server:3.0.8'
implementation 'javax.ws.rs:jsr311-api:1.1.1'
implementation 'org.glassfish.jersey.containers:jersey-container-grizzly2-http:2.36'
// jakarta.activation-api
// jakarta.xml.bind-api
// hk2-locator
// org.osgi.framework

// https://mvnrepository.com/artifact/jakarta.activation/jakarta.activation-api
implementation 'jakarta.activation:jakarta.activation-api:1.2.2'
// https://mvnrepository.com/artifact/jakarta.xml.bind/jakarta.xml.bind-api
implementation 'jakarta.xml.bind:jakarta.xml.bind-api:2.3.3'
// https://mvnrepository.com/artifact/org.glassfish.hk2/hk2-locator
implementation 'org.glassfish.hk2:hk2-locator:2.6.1'
// https://mvnrepository.com/artifact/org.glassfish.jersey.core/jersey-common
implementation 'org.glassfish.jersey.core:jersey-common:2.36'

implementation 'org.glassfish.jersey.inject:jersey-hk2:2.36'
implementation 'org.osgi:org.osgi.framework:1.10.0'

    implementation fileTree(include: ['*.jar'], dir: 'libs')

// 	implementation group: 'org.json', name: 'json', version: '20220320'
// 	implementation group: 'javax.activation', name: 'activation', version: '1.1.1'
}

application {
    // Define the main class for the application.
    mainClass = 'com.HttpCatPure'
}

jar {
   from {
    configurations.compileClasspath.collect { it.isDirectory() ? it : zipTree(it) }
  }
  duplicatesStrategy = DuplicatesStrategy.EXCLUDE
  
  
    manifest.attributes["Main-Class"] = 'com.HttpCatPure'
//     manifest.attributes["Class-Path"] = configurations
//         .runtimeClasspath
//         .get()
//         .joinToString(separator = " ") { file ->
//             "libs/${file.name}"
//         }
}

graalvmNative {
    agent {
        defaultMode = "standard"

        modes {
            conditional {
                userCodeFilterPath = "user-code-filter.json"
            }
        }

        metadataCopy {
            mergeWithExisting = true
            inputTaskNames.add("test")
            outputDirectories.add("build/native/metadataCopyTest")
        }
    }
    binaries {
        main {
            // Main options

            // Advanced options
            buildArgs.add('-H:EnableURLProtocols=http,https') // Passes '-H:Extra' to the native image builder options. This can be used to pass parameters which are not directly supported by this extension
            buildArgs.add('--initialize-at-build-time=org.glassfish.jersey.client.internal.HttpUrlConnector')
            buildArgs.add('-H:+ReportExceptionStackTraces')
            buildArgs.add('--no-fallback')
            buildArgs.add('--report-unsupported-elements-at-runtime')
  
            // Runtime options
            runtimeArgs.add('--help') // Passes '--help' to built image, during "nativeRun" task

        }
        test {
            verbose = true
        }
    }
}


graalvmNative {

    binaries {
        main {
            // Main options

            // Advanced options
            buildArgs.add('-H:EnableURLProtocols=http,https') // Passes '-H:Extra' to the native image builder options. This can be used to pass parameters which are not directly supported by this extension
            buildArgs.add('--initialize-at-build-time=org.glassfish.jersey.client.internal.HttpUrlConnector')
            buildArgs.add('-H:+ReportExceptionStackTraces')
            buildArgs.add('--no-fallback')
            buildArgs.add('--report-unsupported-elements-at-runtime')
  
            // Runtime options
            runtimeArgs.add('--help') // Passes '--help' to built image, during "nativeRun" task

        }
    }
}
